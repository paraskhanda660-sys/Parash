version: '3.8'\n\nservices:\n  postgres:\n    image: postgres:latest\n    restart: always\n    environment:\n      POSTGRES_DB: treeplazzma\n      POSTGRES_USER: user\n      POSTGRES_PASSWORD: password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - "5432:5432"\n\n  redis:\n    image: redis:latest\n    restart: always\n    ports:\n      - "6379:6379"\n\n  emqx:\n    image: emqx/emqx:latest\n    restart: always\n    ports:\n      - "1883:1883"\n      - "8083:8083" # Web Dashboard\n    environment:\n      EMQX_CLUSTER__DISCOVERY: static\n      EMQX_CLUSTER__STATIC__NODES: emqx@emqx\n\n  fastapi:\n    build: ./path_to_fastapi_code\n    restart: always\n    depends_on:\n      - postgres\n      - redis\n      - emqx\n    ports:\n      - "8000:8000"\n    environment:\n      DATABASE_URL: postgres://user:password@postgres:5432/treeplazzma\n\n  worker:\n    build: ./path_to_worker_code\n    restart: always\n    depends_on:\n      - postgres\n      - redis\n      - emqx\n\nvolumes:\n  postgres_data: